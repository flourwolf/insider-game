<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>インサイダー</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: sans-serif;
  text-align: center;
  padding: 20px;
  background: #f9f9f9;
}
h1 { user-select: none; }
<!-- deploy test -->
input, button {
  font-size: 16px;
  padding: 6px;
  margin: 5px;
  width: 90%;
  max-width: 420px;
}

#result {
  font-size: 24px;
  margin-top: 20px;
  font-weight: bold;
}
#word {
  font-size: 22px;
  margin-top: 10px;
  font-weight: bold;
}

.villager { color: #2e7d32; }
.insider  { color: #c62828; }
.master   { color: #1565c0; }
.word     { color: #1565c0; }

.mode-select label {
  display: flex;
  align-items: center;
  gap: 4px;
  justify-content: center;
  white-space: nowrap;
}
</style>
</head>
<body>

<h1 id="title">インサイダーゲーム</h1>

<div>
  シード値（全員共通）<br>
  <input id="seed">

  <br>参加人数<br>
  <input id="count" type="number" min="3" value="5">

  <br>自分の参加番号<br>
  <input id="number" type="number" min="1">

  <div class="mode-select">
    <label>
      通常モード
      <input type="radio" name="mode" value="normal" checked>
    </label>
    <label>
      マスター固定モード
      <input type="radio" name="mode" value="fixed">
    </label>
  </div>

  <div id="masterNumberBox" style="display:none;">
    マスターの参加番号<br>
    <input id="masterNumber" type="number" min="1">
  </div>

  <button onclick="judge()">役職を確認</button>
</div>

<div id="result"></div>
<div id="word"></div>

<script>
// ================================
// お題リスト（外部ファイル）
// ================================
let words = [];

fetch("words.txt")
  .then(res => {
    if (!res.ok) throw new Error("words.txt が読み込めません");
    return res.text();
  })
  .then(text => {
    words = text
      .split("\n")
      .map(w => w.trim())
      .filter(Boolean);
  })
  .catch(err => {
    alert("お題リストの読み込みに失敗しました");
    console.error(err);
  });

// ================================
// シード乱数
// ================================
function seededRandom(seed) {
  let t = seed;
  return function() {
    t += 0x6D2B79F5;
    let r = Math.imul(t ^ t >>> 15, 1 | t);
    r ^= r + Math.imul(r ^ r >>> 7, 61 | r);
    return ((r ^ r >>> 14) >>> 0) / 4294967296;
  };
}

// ================================
// モード切替
// ================================
document.querySelectorAll('input[name="mode"]').forEach(radio => {
  radio.addEventListener("change", () => {
    const fixed =
      document.querySelector('input[name="mode"]:checked').value === "fixed";
    document.getElementById("masterNumberBox").style.display =
      fixed ? "block" : "none";
  });
});

// ================================
// 判定処理
// ================================
function judge() {
  if (words.length === 0) {
    alert("お題リストがまだ読み込まれていません");
    return;
  }

  const seedText = document.getElementById("seed").value;
  const count = Number(document.getElementById("count").value);
  const myNumber = Number(document.getElementById("number").value);
  const mode =
    document.querySelector('input[name="mode"]:checked').value;
  const masterNum =
    Number(document.getElementById("masterNumber").value);

  const resultEl = document.getElementById("result");
  const wordEl = document.getElementById("word");

  resultEl.textContent = "";
  wordEl.textContent = "";
  resultEl.className = "";
  wordEl.className = "";

  if (!seedText || myNumber < 1 || myNumber > count) {
    alert("入力を確認してください");
    return;
  }

  let seed = 0;
  for (let c of seedText) seed += c.charCodeAt(0);
  const rand = seededRandom(seed);

  let master, insider;

  if (mode === "fixed") {
    if (masterNum < 1 || masterNum > count) {
      alert("マスター番号が不正です");
      return;
    }
    master = masterNum;

    const others = [];
    for (let i = 1; i <= count; i++) {
      if (i !== master) others.push(i);
    }
    insider = others[Math.floor(rand() * others.length)];
  } else {
    const players = [];
    for (let i = 1; i <= count; i++) players.push(i);

    for (let i = players.length - 1; i > 0; i--) {
      const j = Math.floor(rand() * (i + 1));
      [players[i], players[j]] = [players[j], players[i]];
    }

    master = players[0];
    insider = players[1];
  }

  let role = "村人";
  let cls = "villager";

  if (myNumber === master) {
    role = "マスター";
    cls = "master";
  } else if (myNumber === insider) {
    role = "インサイダー";
    cls = "insider";
  }

  const wordText =
    words[Math.floor(rand() * words.length)];

  resultEl.textContent = `あなたの役職は「${role}」です`;
  resultEl.classList.add(cls);

  if (role !== "村人") {
    wordEl.textContent = `お題：${wordText}`;
    wordEl.classList.add("word");
  }
}
</script>

</body>

</html>
